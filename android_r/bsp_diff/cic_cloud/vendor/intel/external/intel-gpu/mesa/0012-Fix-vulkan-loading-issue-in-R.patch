From 8ce7a4305cee9538a86022453fa0d1730a58df77 Mon Sep 17 00:00:00 2001
From: yuchen5 <yu.y.chen@intel.com>
Date: Fri, 19 Aug 2022 14:34:18 +0800
Subject: [PATCH] Subject: [PATCH] Fix vulkan loading issue in R

Framework will not load vulkan from /vendor/lib[64]/hw, so move it to
/vendor/lib[64]. Also vulkan.intel.so expects sha1 build-id, but meson
system fallback it md5. So just force the build-id to sha1.

Signed-off-by: Marc Mao <marc.mao@intel.com>
Change-Id: I04075b13361ae8bdf99491aedfdfdf44a7b41865
---
 android/Android.mk           | 2 +-
 src/intel/vulkan/meson.build | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/android/Android.mk b/android/Android.mk
index 1a53fbd73f5..7261614b3a9 100644
--- a/android/Android.mk
+++ b/android/Android.mk
@@ -166,7 +166,7 @@ $(eval $(call mesa3d-lib,libGLESv2_mesa,.so.2,egl,MESA3D_LIBGLESV2_BIN))
 
 # Modules 'vulkan.{driver_name}', produces '/vendor/lib{64}/hw/vulkan.{driver_name}.so' HAL
 $(foreach driver,$(BOARD_MESA3D_VULKAN_DRIVERS), \
-    $(eval $(call mesa3d-lib,vulkan.$(MESA_VK_LIB_SUFFIX_$(driver)),.so.0,hw,MESA3D_VULKAN_$(driver)_BIN)))
+    $(eval $(call mesa3d-lib,vulkan.$(MESA_VK_LIB_SUFFIX_$(driver)),.so.0,,MESA3D_VULKAN_$(driver)_BIN)))
 
 ifneq ($(filter true, $(BOARD_MESA3D_BUILD_LIBGBM)),)
 # Modules 'libgbm', produces '/vendor/lib{64}/libgbm.so'
diff --git a/src/intel/vulkan/meson.build b/src/intel/vulkan/meson.build
index cb93428c1bd..3649f3af4d5 100644
--- a/src/intel/vulkan/meson.build
+++ b/src/intel/vulkan/meson.build
@@ -202,7 +202,7 @@ libvulkan_intel = shared_library(
   ],
   c_args : anv_flags,
   gnu_symbol_visibility : 'hidden',
-  link_args : [ld_args_build_id, ld_args_bsymbolic, ld_args_gc_sections],
+  link_args : ['-Wl,--build-id=sha1', ld_args_bsymbolic, ld_args_gc_sections],
   install : true,
 )
 
-- 
2.17.1


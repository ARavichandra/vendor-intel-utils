From 14ae95afa8a835484aef22b0e86f52edea501fc2 Mon Sep 17 00:00:00 2001
From: Hongcheng Xie <hongcheng.xie@intel.com>
Date: Thu, 2 Jul 2020 20:13:32 +0800
Subject: [PATCH] Use env parameter to load different GL library

Change-Id: I82f661a9ff26a39518dbc4b1072c04b9c91f718f
Signed-off-by: Hongcheng Xie <hongcheng.xie@intel.com>
---
 opengl/libs/EGL/Loader.cpp | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/opengl/libs/EGL/Loader.cpp b/opengl/libs/EGL/Loader.cpp
index e19802b32..5a6d7a73d 100644
--- a/opengl/libs/EGL/Loader.cpp
+++ b/opengl/libs/EGL/Loader.cpp
@@ -664,13 +664,15 @@ Loader::driver_t* Loader::attempt_to_load_system_driver(egl_connection_t* cnx, c
     ATRACE_CALL();
     android::GraphicsEnv::getInstance().setDriverToLoad(android::GpuStatsInfo::Driver::GL);
     driver_t* hnd = nullptr;
-    void* dso = load_system_driver("GLES", suffix, exact);
-    if (dso) {
-        initialize_api(dso, cnx, EGL | GLESv1_CM | GLESv2);
-        hnd = new driver_t(dso);
-        return hnd;
+    if (getenv("K8S_ENV_USE_GFX") != NULL && strcmp(getenv("K8S_ENV_USE_GFX"), "true") == 0) {
+        void* dso = load_system_driver("GLES", suffix, exact);
+        if (dso) {
+            initialize_api(dso, cnx, EGL | GLESv1_CM | GLESv2);
+            hnd = new driver_t(dso);
+            return hnd;
+        }
     }
-    dso = load_system_driver("EGL", suffix, exact);
+    void* dso = load_system_driver("EGL", suffix, exact);
     if (dso) {
         initialize_api(dso, cnx, EGL);
         hnd = new driver_t(dso);
-- 
2.17.1


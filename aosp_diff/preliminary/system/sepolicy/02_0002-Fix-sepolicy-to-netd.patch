From 565e98a7652f57d8439146cf803dd939207e758e Mon Sep 17 00:00:00 2001
From: steven_fann@realtek.com
Date: Tue, 2 Feb 2021 11:22:53 +0530
Subject: [PATCH] Fix sepolicy to netd.

Allow netd to get adb port from property service.adb.tcp.port

Bug: b/161861298
Test: atest android.net.cts.Ikev2VpnTest#testStartStopVpnProfileV4

Tracked-On: OAM-95330
Signed-off-by: Aiswarya Cyriac <aiswarya.cyriac@intel.com>
---
 private/netd.te | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/private/netd.te b/private/netd.te
index 41473b73d..809de6db4 100644
--- a/private/netd.te
+++ b/private/netd.te
@@ -11,6 +11,8 @@ allow netd clatd:process signal;
 
 # give netd permission to setup iptables rule with xt_bpf, attach program to cgroup, and read/write
 # the map created by bpfloader
+get_prop(netd, adbd_config_prop)
+
 allow netd bpfloader:bpf { prog_run map_read map_write };
 
 # in order to invoke side effect of close() on such a socket calling synchronize_rcu()
-- 
2.29.2


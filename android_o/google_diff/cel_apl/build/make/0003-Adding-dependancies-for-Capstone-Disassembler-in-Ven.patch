From f7210dca27fcf8f04706803eb57ccd601a2ae900 Mon Sep 17 00:00:00 2001
From: Priyanka Bose <priyanka.bose@intel.com>
Date: Sun, 31 Dec 2017 04:25:08 +0530
Subject: [PATCH 1/4] Adding dependancies for Capstone Disassembler in Vendor
 Art

Change-Id: Icffedb410c01fc8958937df6ca7474335cbcedcc
Tracked-On: https://jira01.devtools.intel.com/browse/OAM-55911
Category: device enablement
Domain: AOSP.ART-Other
Origin: internal
Upstream-Candidate: no, proprietary
Signed-off-by: Priyanka Bose <priyanka.bose@intel.com>
---
 core/product_config.mk | 7 +++++++
 core/soong_config.mk   | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/core/product_config.mk b/core/product_config.mk
index f7ae834..a4a98a6 100644
--- a/core/product_config.mk
+++ b/core/product_config.mk
@@ -433,6 +433,13 @@ PRODUCT_ART_TARGET_INCLUDE_DEBUG_BUILD := \
 PRODUCT_ART_USE_READ_BARRIER := \
     $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_ART_USE_READ_BARRIER))
 
+
+# Make this art vendor variable visible to soong_config.mk.
+CAPSTONE_EXT_LIBRARY := $(strip $(wildcard $$(ANDROID_BUILD_TOP)/vendor/intel/external/capstone/Android.bp))
+ifneq ($$(CAPSTONE_EXT_LIBRARY),) 
+  ART_CAPSTONE_INCLUDES := true
+endif
+
 # Whether the product is an Android Things variant.
 PRODUCT_IOT := \
     $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_IOT))
diff --git a/core/soong_config.mk b/core/soong_config.mk
index cdd2896..f87b0ae 100644
--- a/core/soong_config.mk
+++ b/core/soong_config.mk
@@ -87,6 +87,8 @@ $(SOONG_VARIABLES): FORCE
 	echo ''; \
 	echo '    "ArtUseReadBarrier": $(if $(filter false,$(PRODUCT_ART_USE_READ_BARRIER)),false,true),'; \
 	echo ''; \
+        echo '    "AutoFastJni": $(if $(filter true,$(ART_CAPSTONE_INCLUDES)),true,false),'; \
+	echo ''; \
 	echo '    "BtConfigIncludeDir": "$(BOARD_BLUETOOTH_BDROID_BUILDCFG_INCLUDE_DIR)",'; \
 	echo ''; \
 	echo '    "DeviceKernelHeaders": $(call json_list,$(strip $(TARGET_PROJECT_SYSTEM_INCLUDES)))'; \
-- 
1.9.1


From c9554fe8884efa239074f29cc5fb30ab94fbe68a Mon Sep 17 00:00:00 2001
From: lab_aqa <lab_aqa@intel.com>
Date: Wed, 11 Jul 2018 09:53:12 +0530
Subject: [PATCH 4/4] Improvement bug  OAM-66361

Change-Id: I394da44b883902c2a09c7c4ad06a93c88602d05b
Tracked-On:https://jira01.devtools.intel.com/browse/OAM-66361
---
 core/product_config.mk | 4 ++--
 core/soong_config.mk   | 2 ++
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/core/product_config.mk b/core/product_config.mk
index a4a98a6..46abcc1 100644
--- a/core/product_config.mk
+++ b/core/product_config.mk
@@ -435,8 +435,8 @@ PRODUCT_ART_USE_READ_BARRIER := \
 
 
 # Make this art vendor variable visible to soong_config.mk.
-CAPSTONE_EXT_LIBRARY := $(strip $(wildcard $$(ANDROID_BUILD_TOP)/vendor/intel/external/capstone/Android.bp))
-ifneq ($$(CAPSTONE_EXT_LIBRARY),) 
+CAPSTONE_EXT_LIBRARY := $(strip $(ANDROID_BUILD_TOP)/vendor/intel/external/capstone/Android.bp)
+ifneq ("$(wildcard$(CAPSTONE_EXT_LIBRARY))","") 
   ART_CAPSTONE_INCLUDES := true
 endif
 
diff --git a/core/soong_config.mk b/core/soong_config.mk
index 75828b8..733af10 100644
--- a/core/soong_config.mk
+++ b/core/soong_config.mk
@@ -90,6 +90,8 @@ $(SOONG_VARIABLES): FORCE
 	echo ''; \
         echo '    "AutoFastJni": $(if $(filter true,$(ART_CAPSTONE_INCLUDES)),true,false),'; \
 	echo ''; \
+	echo '    "AutoFastJni": $(if $(filter true,$(ART_CAPSTONE_INCLUDES)),true,false),'; \
+	echo ''; \
 	echo '    "BtConfigIncludeDir": "$(BOARD_BLUETOOTH_BDROID_BUILDCFG_INCLUDE_DIR)",'; \
 	echo ''; \
 	echo '    "DeviceKernelHeaders": $(call json_list,$(strip $(TARGET_PROJECT_SYSTEM_INCLUDES)))'; \
-- 
1.9.1

